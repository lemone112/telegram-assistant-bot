# Standalone docker-compose for the Telegram bot.
# Connects to the labpics-dashboard Docker network to share PostgreSQL and Redis.
#
# Usage:
#   docker compose up -d
#
# Pre-requisites:
#   - labpics-dashboard must be running (provides db, redis, server)
#   - Copy .env.example to .env and fill in secrets

services:
  telegram-bot:
    build: .
    env_file: .env
    environment:
      # Override to connect to dashboard's db and redis via Docker network
      DASHBOARD_DATABASE_URL: postgresql://app:app@db:5432/labpics
      REDIS_URL: redis://redis:6379
      DASHBOARD_API_URL: http://server:8080
      PORT: "3000"
    ports:
      - "${BOT_PORT:-3000}:3000"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:3000/health"]
      interval: 30s
      timeout: 5s
      retries: 3

# Join the labpics-dashboard network so we can reach db, redis, server by name
networks:
  default:
    name: labpics-dashboard_default
    external: true
